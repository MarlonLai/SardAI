import{p as _,r,a as U,b as B,a0 as j,j as e,F as O,a9 as R,$ as V,B as D,a8 as q,C as y,g as p,h as f,k as b,q as v,s as N,a2 as w,a1 as F,ac as J}from"./index-459497b8.js";import{T as M,a as P,b as S,c as C}from"./tabs-7b5ae36b.js";const $=_("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),H=_("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);function G(){const[d,L]=r.useState([]),[o,T]=r.useState([]),[m,l]=r.useState({admin:!0,system:!0}),[n,k]=r.useState(""),[c,A]=r.useState(""),{user:i}=U(),{toast:x}=B();r.useEffect(()=>{h(),u()},[n,c]);const h=async()=>{try{l(a=>({...a,admin:!0}));const{data:s,error:t}=await j.functions.invoke("admin-logs",{body:{type:"admin",search:n||null,limit:100,adminEmail:i==null?void 0:i.email}});if(t)throw t;L(s||[])}catch(s){x({title:"Errore nel caricamento dei log admin",description:s.message,variant:"destructive"})}finally{l(s=>({...s,admin:!1}))}},u=async()=>{try{l(a=>({...a,system:!0}));const{data:s,error:t}=await j.functions.invoke("admin-logs",{body:{type:"system",level:c||null,search:n||null,limit:100,adminEmail:i==null?void 0:i.email}});if(t)throw t;T(s||[])}catch(s){x({title:"Errore nel caricamento dei log di sistema",description:s.message,variant:"destructive"})}finally{l(s=>({...s,system:!1}))}},z=s=>{const t={info:{color:"bg-blue-500/20 text-blue-400",icon:H},warning:{color:"bg-yellow-500/20 text-yellow-400",icon:F},error:{color:"bg-red-500/20 text-red-400",icon:J},critical:{color:"bg-red-600/20 text-red-300",icon:$}},a=t[s]||t.info,I=a.icon;return e.jsxs(v,{className:`${a.color} border-0`,children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),s.toUpperCase()]})},g=s=>new Date(s).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),E=s=>({user_deleted:"Utente Eliminato",user_confirmed:"Utente Confermato",confirmation_resent:"Email Conferma Reinviata",password_reset_sent:"Reset Password Inviato",user_list_viewed:"Lista Utenti Visualizzata",stats_viewed:"Statistiche Visualizzate",reports_viewed:"Segnalazioni Visualizzate",report_status_updated:"Stato Segnalazione Aggiornato",report_notes_added:"Note Segnalazione Aggiunte"})[s]||s;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center",children:[e.jsx(O,{className:"w-6 h-6 mr-2"}),"Log di Sistema"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(V,{placeholder:"Cerca nei log...",value:n,onChange:s=>k(s.target.value),className:"pl-10 bg-slate-800/50 border-slate-600 text-white placeholder:text-gray-400 w-64"})]}),e.jsxs(D,{onClick:()=>{h(),u()},variant:"outline",size:"sm",className:"border-white/20 text-white hover:bg-white/10",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Aggiorna"]})]})]}),e.jsxs(M,{defaultValue:"admin",className:"space-y-6",children:[e.jsxs(P,{className:"bg-slate-800/50 border border-slate-600",children:[e.jsx(S,{value:"admin",children:"Log Admin"}),e.jsx(S,{value:"system",children:"Log Sistema"})]}),e.jsx(C,{value:"admin",className:"space-y-4",children:e.jsxs(y,{className:"sardinian-card",children:[e.jsx(p,{children:e.jsx(f,{className:"text-white",children:"Azioni Amministrative"})}),e.jsx(b,{children:m.admin?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsx("div",{className:"space-y-4",children:d.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Nessun log admin trovato."}):d.map(s=>{var t,a;return e.jsxs("div",{className:"bg-slate-800/30 p-4 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(v,{className:"bg-blue-500/20 text-blue-400 border-0",children:E(s.action)}),e.jsxs("div",{className:"flex items-center text-gray-400 text-sm",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),((t=s.admin)==null?void 0:t.full_name)||((a=s.admin)==null?void 0:a.email)||"Admin"]})]}),e.jsxs("div",{className:"flex items-center text-gray-400 text-sm",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),g(s.created_at)]})]}),s.target_user&&e.jsxs("p",{className:"text-gray-300 text-sm mb-2",children:["Target: ",s.target_user.full_name||s.target_user.email]}),s.details&&Object.keys(s.details).length>0&&e.jsx("div",{className:"bg-slate-900/50 p-3 rounded mt-2",children:e.jsx("pre",{className:"text-xs text-gray-400 whitespace-pre-wrap",children:JSON.stringify(s.details,null,2)})})]},s.id)})})})]})}),e.jsxs(C,{value:"system",className:"space-y-4",children:[e.jsx("div",{className:"flex items-center space-x-4 mb-4",children:e.jsxs("select",{value:c,onChange:s=>A(s.target.value),className:"bg-slate-800/50 border border-slate-600 text-white rounded-md px-3 py-2",children:[e.jsx("option",{value:"",children:"Tutti i livelli"}),e.jsx("option",{value:"info",children:"Info"}),e.jsx("option",{value:"warning",children:"Warning"}),e.jsx("option",{value:"error",children:"Error"}),e.jsx("option",{value:"critical",children:"Critical"})]})}),e.jsxs(y,{className:"sardinian-card",children:[e.jsx(p,{children:e.jsx(f,{className:"text-white",children:"Log di Sistema"})}),e.jsx(b,{children:m.system?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsx("div",{className:"space-y-4",children:o.length===0?e.jsx("p",{className:"text-gray-400 text-center py-8",children:"Nessun log di sistema trovato."}):o.map(s=>e.jsxs("div",{className:"bg-slate-800/30 p-4 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[z(s.level),s.user&&e.jsxs("div",{className:"flex items-center text-gray-400 text-sm",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),s.user.full_name||s.user.email]})]}),e.jsxs("div",{className:"flex items-center text-gray-400 text-sm",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),g(s.created_at)]})]}),e.jsx("p",{className:"text-gray-300 mb-2",children:s.message}),s.context&&Object.keys(s.context).length>0&&e.jsx("div",{className:"bg-slate-900/50 p-3 rounded mt-2",children:e.jsx("pre",{className:"text-xs text-gray-400 whitespace-pre-wrap",children:JSON.stringify(s.context,null,2)})})]},s.id))})})]})]})]})]})}export{G as default};
