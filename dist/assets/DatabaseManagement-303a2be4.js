import{p as V,r as c,b as X,a0 as x,j as e,a9 as Z,$ as h,B as r,a8 as U,C as N,g as p,h as v,k as f,ae as F,q as j,c as L,U as Y,l as M,I as ee,J as se,K as ae,N as te,O as le,Q as re,T as ie,V as ne,W as ce,E as R}from"./index-459497b8.js";import"./textarea-2b488213.js";import{T as de,a as oe,b as A,c as D}from"./tabs-7b5ae36b.js";import{P as B}from"./plus-c6d946f8.js";import{S as q}from"./save-8b052415.js";import{T as me}from"./trash-2-848cc76c.js";const I=V("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),xe=V("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);function he(){const[O,g]=c.useState([]),[S,z]=c.useState([]),[P,T]=c.useState(!0),[b,G]=c.useState(""),[d,m]=c.useState(null),[i,u]=c.useState({full_name:"",role:"user",is_premium:!1}),[H,w]=c.useState(!1),{toast:o}=X();c.useEffect(()=>{y()},[]);const y=async()=>{try{T(!0);const{data:s,error:a}=await x.from("profiles").select("*").order("updated_at",{ascending:!1});if(a)throw a;g(s||[]);const{data:t,error:l}=await x.functions.invoke("admin-database",{body:{action:"list_auth_users"}});if(l)throw l;z(t||[])}catch(s){o({title:"Errore nel caricamento dei dati",description:s.message,variant:"destructive"})}finally{T(!1)}},_=async(s,a)=>{try{const{data:t,error:l}=await x.from("profiles").update(a).eq("id",s).select().single();if(l)throw l;g(n=>n.map(E=>E.id===s?t:E)),m(null),o({title:"Profilo aggiornato",description:"Le modifiche sono state salvate con successo."})}catch(t){o({title:"Errore nell'aggiornamento",description:t.message,variant:"destructive"})}},Q=async()=>{try{const{data:s,error:a}=await x.functions.invoke("admin-database",{body:{action:"create_auth_user",email:i.email,password:i.password||"TempPassword123!",full_name:i.full_name}});if(a)throw a;const{data:t,error:l}=await x.from("profiles").insert({id:s.user.id,full_name:i.full_name,role:i.role,is_premium:i.is_premium}).select().single();if(l)throw l;g(n=>[t,...n]),u({full_name:"",role:"user",is_premium:!1}),w(!1),o({title:"Utente creato",description:"Nuovo utente creato con successo."}),y()}catch(s){o({title:"Errore nella creazione",description:s.message,variant:"destructive"})}},$=async s=>{try{const{error:a}=await x.functions.invoke("admin-database",{body:{action:"delete_auth_user",userId:s}});if(a)throw a;g(t=>t.filter(l=>l.id!==s)),z(t=>t.filter(l=>l.id!==s)),o({title:"Utente eliminato",description:"L'utente è stato eliminato con successo."})}catch(a){o({title:"Errore nell'eliminazione",description:a.message,variant:"destructive"})}},J=async(s,a)=>{await _(s,{is_premium:!a})},K=async(s,a)=>{await _(s,{role:a==="admin"?"user":"admin"})},C=O.filter(s=>{var a,t;return((a=s.full_name)==null?void 0:a.toLowerCase().includes(b.toLowerCase()))||((t=s.role)==null?void 0:t.toLowerCase().includes(b.toLowerCase()))}),W=s=>S.find(a=>a.id===s),k=s=>s?new Date(s).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Mai";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center",children:[e.jsx(I,{className:"w-6 h-6 mr-2"}),"Gestione Database"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(h,{placeholder:"Cerca utenti...",value:b,onChange:s=>G(s.target.value),className:"pl-10 bg-slate-800/50 border-slate-600 text-white placeholder:text-gray-400 w-64"})]}),e.jsxs(r,{onClick:y,variant:"outline",size:"sm",className:"border-white/20 text-white hover:bg-white/10",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Aggiorna"]}),e.jsxs(r,{onClick:()=>w(!0),className:"sardinian-gradient hover:opacity-90",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Nuovo Utente"]})]})]}),e.jsxs(de,{defaultValue:"profiles",className:"space-y-6",children:[e.jsxs(oe,{className:"bg-slate-800/50 border border-slate-600",children:[e.jsx(A,{value:"profiles",children:"Profili Utenti"}),e.jsx(A,{value:"auth",children:"Dati Autenticazione"}),e.jsx(A,{value:"system",children:"Configurazioni Sistema"})]}),e.jsxs(D,{value:"profiles",className:"space-y-4",children:[H&&e.jsxs(N,{className:"sardinian-card",children:[e.jsx(p,{children:e.jsxs(v,{className:"text-white flex items-center",children:[e.jsx(B,{className:"w-5 h-5 mr-2"}),"Crea Nuovo Utente"]})}),e.jsxs(f,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-2 block",children:"Nome Completo"}),e.jsx(h,{value:i.full_name,onChange:s=>u(a=>({...a,full_name:s.target.value})),className:"bg-slate-800/50 border-slate-600 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-2 block",children:"Email"}),e.jsx(h,{type:"email",value:i.email||"",onChange:s=>u(a=>({...a,email:s.target.value})),className:"bg-slate-800/50 border-slate-600 text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-2 block",children:"Ruolo"}),e.jsxs("select",{value:i.role,onChange:s=>u(a=>({...a,role:s.target.value})),className:"w-full bg-slate-800/50 border border-slate-600 text-white rounded-md px-3 py-2",children:[e.jsx("option",{value:"user",children:"Utente"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_premium",checked:i.is_premium,onChange:s=>u(a=>({...a,is_premium:s.target.checked})),className:"rounded"}),e.jsx("label",{htmlFor:"is_premium",className:"text-sm text-gray-300",children:"Account Premium"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsxs(r,{variant:"outline",onClick:()=>w(!1),className:"border-gray-500 text-gray-300 hover:bg-gray-500/10",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Annulla"]}),e.jsxs(r,{onClick:Q,className:"sardinian-gradient hover:opacity-90",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Crea Utente"]})]})]})]}),e.jsxs(N,{className:"sardinian-card",children:[e.jsx(p,{children:e.jsxs(v,{className:"text-white",children:["Profili Utenti (",C.length,")"]})}),e.jsx(f,{children:P?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-left text-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-600",children:[e.jsx("th",{className:"p-4 font-medium",children:"Utente"}),e.jsx("th",{className:"p-4 font-medium",children:"Ruolo"}),e.jsx("th",{className:"p-4 font-medium",children:"Premium"}),e.jsx("th",{className:"p-4 font-medium",children:"Creato"}),e.jsx("th",{className:"p-4 font-medium",children:"Ultimo Aggiornamento"}),e.jsx("th",{className:"p-4 font-medium text-right",children:"Azioni"})]})}),e.jsx("tbody",{children:C.map(s=>{const a=W(s.id),t=(d==null?void 0:d.id)===s.id;return e.jsxs("tr",{className:"border-b border-slate-700 hover:bg-slate-800/50",children:[e.jsx("td",{className:"p-4",children:e.jsx("div",{children:t?e.jsx(h,{value:d.full_name||"",onChange:l=>m(n=>({...n,full_name:l.target.value})),className:"bg-slate-800/50 border-slate-600 text-white text-sm"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-medium",children:s.full_name||"Nome non disponibile"}),e.jsx("p",{className:"text-gray-400 text-sm",children:a==null?void 0:a.email})]})})}),e.jsx("td",{className:"p-4",children:t?e.jsxs("select",{value:d.role,onChange:l=>m(n=>({...n,role:l.target.value})),className:"bg-slate-800/50 border border-slate-600 text-white rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"user",children:"Utente"}),e.jsx("option",{value:"admin",children:"Admin"})]}):e.jsx(j,{className:s.role==="admin"?"bg-red-500/20 text-red-400 border-0":"bg-blue-500/20 text-blue-400 border-0",children:s.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),"Admin"]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-3 h-3 mr-1"}),"Utente"]})})}),e.jsx("td",{className:"p-4",children:t?e.jsx("input",{type:"checkbox",checked:d.is_premium,onChange:l=>m(n=>({...n,is_premium:l.target.checked})),className:"rounded"}):e.jsx(j,{className:s.is_premium?"bg-yellow-500/20 text-yellow-400 border-0":"bg-gray-500/20 text-gray-400 border-0",children:s.is_premium?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"Premium"]}):"Gratuito"})}),e.jsx("td",{className:"p-4 text-gray-300 text-sm",children:k(a==null?void 0:a.created_at)}),e.jsx("td",{className:"p-4 text-gray-300 text-sm",children:k(s.updated_at)}),e.jsx("td",{className:"p-4 text-right",children:e.jsx("div",{className:"flex items-center justify-end space-x-2",children:t?e.jsxs(e.Fragment,{children:[e.jsx(r,{size:"sm",onClick:()=>_(s.id,d),className:"bg-green-600 hover:bg-green-700",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>m(null),className:"text-gray-400 hover:text-gray-300",children:e.jsx(F,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>m(s),className:"text-blue-400 hover:bg-blue-400/10 hover:text-blue-300",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>J(s.id,s.is_premium),className:"text-yellow-400 hover:bg-yellow-400/10 hover:text-yellow-300",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>K(s.id,s.role),className:"text-purple-400 hover:bg-purple-400/10 hover:text-purple-300",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx(r,{size:"sm",variant:"ghost",className:"text-red-400 hover:bg-red-400/10 hover:text-red-300",children:e.jsx(me,{className:"w-4 h-4"})})}),e.jsxs(ae,{className:"sardinian-card",children:[e.jsxs(te,{children:[e.jsx(le,{children:"Elimina Utente"}),e.jsxs(re,{children:[`Sei sicuro di voler eliminare l'utente "`,s.full_name,'"? Questa azione è irreversibile e rimuoverà tutti i dati associati.']})]}),e.jsxs(ie,{children:[e.jsx(ne,{children:"Annulla"}),e.jsx(ce,{onClick:()=>$(s.id),className:"bg-destructive hover:bg-destructive/90",children:"Elimina"})]})]})]})]})})})]},s.id)})})]}),C.length===0&&!P&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:b?"Nessun utente trovato per la ricerca.":"Nessun utente presente."})]})})]})]}),e.jsx(D,{value:"auth",className:"space-y-4",children:e.jsxs(N,{className:"sardinian-card",children:[e.jsx(p,{children:e.jsx(v,{className:"text-white",children:"Dati Autenticazione"})}),e.jsx(f,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-600",children:[e.jsx("th",{className:"p-4 font-medium",children:"Email"}),e.jsx("th",{className:"p-4 font-medium",children:"Stato"}),e.jsx("th",{className:"p-4 font-medium",children:"Ultimo Accesso"}),e.jsx("th",{className:"p-4 font-medium",children:"Confermato"}),e.jsx("th",{className:"p-4 font-medium",children:"Provider"})]})}),e.jsx("tbody",{children:S.map(s=>{var a;return e.jsxs("tr",{className:"border-b border-slate-700 hover:bg-slate-800/50",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.email}),e.jsx("p",{className:"text-gray-400 text-xs",children:s.id})]})}),e.jsx("td",{className:"p-4",children:e.jsx(j,{className:s.banned_until?"bg-red-500/20 text-red-400 border-0":"bg-green-500/20 text-green-400 border-0",children:s.banned_until?"Bannato":"Attivo"})}),e.jsx("td",{className:"p-4 text-gray-300 text-sm",children:k(s.last_sign_in_at)}),e.jsx("td",{className:"p-4",children:e.jsx(j,{className:s.email_confirmed_at?"bg-green-500/20 text-green-400 border-0":"bg-yellow-500/20 text-yellow-400 border-0",children:s.email_confirmed_at?"Confermato":"In Attesa"})}),e.jsx("td",{className:"p-4 text-gray-300 text-sm",children:((a=s.app_metadata)==null?void 0:a.provider)||"email"})]},s.id)})})]})})})]})}),e.jsx(D,{value:"system",className:"space-y-4",children:e.jsxs(N,{className:"sardinian-card",children:[e.jsx(p,{children:e.jsxs(v,{className:"text-white flex items-center",children:[e.jsx(R,{className:"w-5 h-5 mr-2"}),"Configurazioni Sistema"]})}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Impostazioni Generali"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-2 block",children:"Nome Applicazione"}),e.jsx(h,{value:"SardAI",className:"bg-slate-800/50 border-slate-600 text-white",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-2 block",children:"Versione"}),e.jsx(h,{value:"1.0.0",className:"bg-slate-800/50 border-slate-600 text-white",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-2 block",children:"Ambiente"}),e.jsx(j,{className:"bg-green-500/20 text-green-400 border-0",children:"Produzione"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Statistiche Database"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Tabelle"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:"5"})]}),e.jsxs("div",{className:"bg-slate-800/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Funzioni"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:"12"})]}),e.jsxs("div",{className:"bg-slate-800/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Policies"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:"25"})]}),e.jsxs("div",{className:"bg-slate-800/30 p-4 rounded-lg",children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Storage"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:"2 Bucket"})]})]})]})]}),e.jsxs("div",{className:"border-t border-slate-600 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Azioni Sistema"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs(r,{variant:"outline",className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/10",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Aggiorna Cache"]}),e.jsxs(r,{variant:"outline",className:"border-green-500/50 text-green-400 hover:bg-green-500/10",children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Backup Database"]}),e.jsxs(r,{variant:"outline",className:"border-yellow-500/50 text-yellow-400 hover:bg-yellow-500/10",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Ottimizza Performance"]})]})]})]})})]})})]})]})}const ve=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"}));export{I as D,he as a,ve as b};
