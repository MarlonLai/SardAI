import{r as n,a as _,b as k,a0 as N,j as e,B as r,a8 as z,C as p,k as v,g as T,h as E,a1 as f,s as y,I,J as B,ab as F,K as G,N as L,O as U,Q as q,T as H,V as M,q as $,a2 as J,aa as K,ac as O}from"./index-459497b8.js";import{T as P}from"./textarea-2b488213.js";import{F as w}from"./flag-2d3d53e0.js";function Y(){const[x,C]=n.useState([]),[A,g]=n.useState(!0),[Q,h]=n.useState(null),[u,c]=n.useState(""),{user:l}=_(),{toast:o}=k();n.useEffect(()=>{d()},[]);const d=async()=>{try{g(!0);const{data:s,error:a}=await N.functions.invoke("admin-reports",{body:{action:"list",adminEmail:l==null?void 0:l.email}});if(a)throw a;C(s||[])}catch(s){o({title:"Errore nel caricamento delle segnalazioni",description:s.message,variant:"destructive"})}finally{g(!1)}},m=async(s,a)=>{try{const{data:t,error:i}=await N.functions.invoke("admin-reports",{body:{action:"update_status",reportId:s,status:a,notes:u,adminEmail:l==null?void 0:l.email}});if(i)throw i;o({title:"Stato aggiornato!",description:`Segnalazione marcata come ${a}.`}),d(),h(null),c("")}catch(t){o({title:"Errore",description:t.message,variant:"destructive"})}},R=s=>{const a={pending:{color:"bg-yellow-500/20 text-yellow-400",icon:J,label:"In Attesa"},reviewed:{color:"bg-blue-500/20 text-blue-400",icon:f,label:"Revisionata"},resolved:{color:"bg-green-500/20 text-green-400",icon:K,label:"Risolta"},dismissed:{color:"bg-gray-500/20 text-gray-400",icon:O,label:"Respinta"}},t=a[s]||a.pending,i=t.icon;return e.jsxs($,{className:`${t.color} border-0`,children:[e.jsx(i,{className:"w-3 h-3 mr-1"}),t.label]})},S=s=>({spam:"Spam",abuse:"Abuso",inappropriate:"Contenuto Inappropriato",other:"Altro"})[s]||s,j=s=>new Date(s).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center",children:[e.jsx(w,{className:"w-6 h-6 mr-2"}),"Gestione Segnalazioni"]}),e.jsxs(r,{onClick:d,variant:"outline",size:"sm",className:"border-white/20 text-white hover:bg-white/10",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Aggiorna"]})]}),A?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsx("div",{className:"grid gap-6",children:x.length===0?e.jsx(p,{className:"sardinian-card",children:e.jsxs(v,{className:"p-8 text-center",children:[e.jsx(w,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Nessuna segnalazione presente."})]})}):x.map(s=>{var a,t,i,b;return e.jsxs(p,{className:"sardinian-card",children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(E,{className:"text-white flex items-center",children:[e.jsx(f,{className:"w-5 h-5 mr-2 text-orange-400"}),S(s.report_type)]}),R(s.status)]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Segnalato da:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-white",children:((a=s.reporter)==null?void 0:a.full_name)||"Nome non disponibile"}),e.jsxs("span",{className:"text-gray-400 text-sm",children:["(",(t=s.reporter)==null?void 0:t.email,")"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Utente segnalato:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-white",children:((i=s.reported_user)==null?void 0:i.full_name)||"Nome non disponibile"}),e.jsxs("span",{className:"text-gray-400 text-sm",children:["(",(b=s.reported_user)==null?void 0:b.email,")"]})]})]})]}),s.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Descrizione:"}),e.jsx("p",{className:"text-gray-300 bg-slate-800/50 p-3 rounded-lg",children:s.description})]}),s.admin_notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Note Admin:"}),e.jsx("p",{className:"text-gray-300 bg-blue-900/20 p-3 rounded-lg border border-blue-500/20",children:s.admin_notes})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-slate-700",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:[e.jsxs("p",{children:["Creata: ",j(s.created_at)]}),s.resolved_at&&e.jsxs("p",{children:["Risolta: ",j(s.resolved_at)]})]}),s.status==="pending"&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(I,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(r,{size:"sm",variant:"outline",className:"border-blue-500/50 text-blue-400 hover:bg-blue-500/10",onClick:()=>{h(s),c(s.admin_notes||"")},children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Gestisci"]})}),e.jsxs(G,{className:"sardinian-card max-w-2xl",children:[e.jsxs(L,{children:[e.jsx(U,{children:"Gestisci Segnalazione"}),e.jsx(q,{children:"Aggiungi note e cambia lo stato della segnalazione."})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-300 mb-2 block",children:"Note Admin:"}),e.jsx(P,{value:u,onChange:D=>c(D.target.value),placeholder:"Aggiungi note sulla segnalazione...",className:"bg-slate-800/50 border-slate-600 text-white",rows:3})]})}),e.jsxs(H,{className:"flex flex-wrap gap-2",children:[e.jsx(M,{children:"Annulla"}),e.jsx(r,{onClick:()=>m(s.id,"reviewed"),className:"bg-blue-600 hover:bg-blue-700",children:"Marca come Revisionata"}),e.jsx(r,{onClick:()=>m(s.id,"resolved"),className:"bg-green-600 hover:bg-green-700",children:"Risolvi"}),e.jsx(r,{onClick:()=>m(s.id,"dismissed"),variant:"outline",className:"border-gray-500 text-gray-300 hover:bg-gray-500/10",children:"Respingi"})]})]})]})})]})]})]},s.id)})})]})}export{Y as default};
