import{p as f,r,a as y,b as w,a0 as b,j as e,C as i,k as l,U,a7 as A,l as C,a1 as S,B as T,a8 as E,g as d,h as o}from"./index-459497b8.js";import{F as L}from"./flag-2d3d53e0.js";const R=f("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);function I(){var j;const[s,g]=r.useState(null),[p,x]=r.useState(!0),[c,m]=r.useState(!1),{user:n}=y(),{toast:N}=w();r.useEffect(()=>{h()},[]);const h=async(t=!1)=>{try{t?m(!0):x(!0);const{data:a,error:u}=await b.functions.invoke("admin-stats",{body:{refresh:t,adminEmail:n==null?void 0:n.email}});if(u)throw u;g(a)}catch(a){N({title:"Errore nel caricamento delle statistiche",description:a.message,variant:"destructive"})}finally{t?m(!1):x(!1)}};if(p)return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[...Array(7)].map((t,a)=>e.jsx(i,{className:"sardinian-card animate-pulse",children:e.jsx(l,{className:"p-6",children:e.jsx("div",{className:"h-16 bg-slate-700 rounded"})})},a))});if(!s)return null;const v=[{title:"Utenti Totali",value:s.totalUsers,icon:U,color:"text-blue-400"},{title:"Nuovi Utenti",value:s.newUsers,icon:A,color:"text-green-400"},{title:"Utenti Premium",value:s.premiumUsers,icon:C,color:"text-yellow-400"},{title:"Attivi (7gg)",value:s.activeUsers,icon:R,color:"text-purple-400"},{title:"Segnalazioni",value:s.pendingReports,icon:L,color:"text-cyan-400"},{title:"Errori Sistema",value:s.systemErrors,icon:S,color:"text-orange-400"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Statistiche Utenti"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("p",{className:"text-gray-400 text-sm",children:["Ultimo aggiornamento: ",s.lastUpdated?new Date(s.lastUpdated).toLocaleString("it-IT"):"Mai"]}),e.jsxs(T,{onClick:()=>h(!0),variant:"outline",size:"sm",disabled:c,className:"border-white/20 text-white hover:bg-white/10",children:[e.jsx(E,{className:`w-4 h-4 mr-2 ${c?"animate-spin":""}`}),c?"Aggiornamento...":"Aggiorna"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:v.map((t,a)=>e.jsx(i,{className:"sardinian-card",children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm font-medium",children:t.title}),e.jsx("p",{className:"text-3xl font-bold text-white mt-1",children:t.value})]}),e.jsx(t.icon,{className:`w-8 h-8 ${t.color}`})]})})},a))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(i,{className:"sardinian-card",children:[e.jsx(d,{children:e.jsx(o,{className:"text-white",children:"Crescita Utenti"})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Nuovi (30gg)"}),e.jsxs("span",{className:"text-blue-400 font-bold",children:["+",s.newUsers]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Attivi"}),e.jsx("span",{className:"text-purple-400 font-bold",children:s.activeUsers})]})]})})]}),e.jsxs(i,{className:"sardinian-card",children:[e.jsx(d,{children:e.jsx(o,{className:"text-white",children:"Premium Stats"})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Utenti Premium"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:s.premiumUsers})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-300",children:"Tasso Conversione"}),e.jsxs("span",{className:"text-green-400 font-bold",children:[s.totalUsers>0?(s.premiumUsers/s.totalUsers*100).toFixed(1):0,"%"]})]})]})})]}),e.jsxs(i,{className:"sardinian-card",children:[e.jsx(d,{children:e.jsx(o,{className:"text-white",children:"Attività Recente"})}),e.jsx(l,{children:e.jsxs("div",{className:"space-y-3",children:[(j=s.recentActivity)==null?void 0:j.slice(0,3).map((t,a)=>e.jsxs("div",{className:"flex items-center space-x-3 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-gray-300",children:t.action}),e.jsx("p",{className:"text-gray-500 text-xs",children:new Date(t.created_at).toLocaleString("it-IT")})]})]},a)),(!s.recentActivity||s.recentActivity.length===0)&&e.jsx("p",{className:"text-gray-400 text-sm",children:"Nessuna attività recente"})]})})]})]})]})}export{I as default};
