import{p as C,r,a as T,b as P,a0 as D,j as e,a9 as M,$ as I,B as a,a8 as L,C as H,g as K,h as Q,k as q,aa as B,a2 as F,I as o,J as h,K as m,N as x,O as j,Q as u,T as g,V as f,W as p}from"./index-459497b8.js";import{T as G}from"./trash-2-848cc76c.js";const V=C("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),J=C("MailCheck",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8",key:"12jkf8"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m16 19 2 2 4-4",key:"1b14m6"}]]),O=C("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);function X(){const[l,E]=r.useState([]),[k,A]=r.useState(!0),[n,U]=r.useState(""),[t,v]=r.useState(0);r.useState(0);const{user:i}=T(),{toast:N}=P(),b=20;r.useEffect(()=>{y()},[t,n]);const y=async()=>{try{A(!0);const{data:s,error:d}=await D.functions.invoke("admin-user-management",{body:{action:"list",limit:b,offset:t*b,search:n||null,adminEmail:i==null?void 0:i.email}});if(d)throw d;E(s||[])}catch(s){N({title:"Errore nel caricamento degli utenti",description:s.message,variant:"destructive"})}finally{A(!1)}},c=async(s,d,R=null)=>{try{const{data:w,error:_}=await D.functions.invoke("admin-user-management",{body:{action:s,userId:d,email:R,adminEmail:i==null?void 0:i.email}});if(_)throw _;N({title:"Successo!",description:w.message||"Azione completata con successo."}),y()}catch(w){N({title:"Errore",description:w.message,variant:"destructive"})}},z=s=>{U(s.target.value),v(0)},S=s=>s?new Date(s).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Mai";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Gestione Utenti"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(I,{placeholder:"Cerca per email o nome...",value:n,onChange:z,className:"pl-10 bg-slate-800/50 border-slate-600 text-white placeholder:text-gray-400 w-64"})]}),e.jsx(a,{onClick:y,variant:"outline",size:"icon",className:"border-white/20 text-white hover:bg-white/10",children:e.jsx(L,{className:"w-4 h-4"})})]})]}),e.jsxs(H,{className:"sardinian-card",children:[e.jsx(K,{children:e.jsxs(Q,{className:"text-white",children:["Utenti Registrati (",l.length,")"]})}),e.jsx(q,{children:k?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-left text-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-600",children:[e.jsx("th",{className:"p-4 font-medium",children:"Utente"}),e.jsx("th",{className:"p-4 font-medium",children:"Stato"}),e.jsx("th",{className:"p-4 font-medium",children:"Registrato"}),e.jsx("th",{className:"p-4 font-medium",children:"Ultimo Accesso"}),e.jsx("th",{className:"p-4 font-medium text-right",children:"Azioni"})]})}),e.jsx("tbody",{children:l.map(s=>e.jsxs("tr",{className:"border-b border-slate-700 hover:bg-slate-800/50",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.full_name||"Nome non disponibile"}),e.jsx("p",{className:"text-gray-400 text-sm",children:s.email}),s.is_premium&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-yellow-500/20 text-yellow-400 mt-1",children:"👑 Premium"})]})}),e.jsxs("td",{className:"p-4",children:[s.email_confirmed_at?e.jsxs("span",{className:"flex items-center text-green-400",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Confermato"]}):e.jsxs("span",{className:"flex items-center text-yellow-400",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"In attesa"]}),s.role==="admin"&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-red-500/20 text-red-400 mt-1",children:"🛡️ Admin"})]}),e.jsx("td",{className:"p-4 text-gray-300",children:S(s.created_at)}),e.jsx("td",{className:"p-4 text-gray-300",children:S(s.last_sign_in_at)}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[!s.email_confirmed_at&&e.jsxs(e.Fragment,{children:[e.jsxs(o,{children:[e.jsx(h,{asChild:!0,children:e.jsx(a,{size:"sm",variant:"ghost",className:"text-green-400 hover:bg-green-400/10 hover:text-green-300",children:e.jsx(O,{className:"w-4 h-4"})})}),e.jsxs(m,{className:"sardinian-card",children:[e.jsxs(x,{children:[e.jsx(j,{children:"Conferma Utente"}),e.jsxs(u,{children:["Sei sicuro di voler confermare manualmente l'utente ",s.email,"? Questa azione è irreversibile."]})]}),e.jsxs(g,{children:[e.jsx(f,{children:"Annulla"}),e.jsx(p,{onClick:()=>c("confirm",s.id),children:"Conferma"})]})]})]}),e.jsxs(o,{children:[e.jsx(h,{asChild:!0,children:e.jsx(a,{size:"sm",variant:"ghost",className:"text-blue-400 hover:bg-blue-400/10 hover:text-blue-300",children:e.jsx(J,{className:"w-4 h-4"})})}),e.jsxs(m,{className:"sardinian-card",children:[e.jsxs(x,{children:[e.jsx(j,{children:"Reinvia Email di Conferma"}),e.jsxs(u,{children:["Sei sicuro di voler reinviare l'email di conferma a ",s.email,"?"]})]}),e.jsxs(g,{children:[e.jsx(f,{children:"Annulla"}),e.jsx(p,{onClick:()=>c("resend_confirmation",null,s.email),children:"Reinvia"})]})]})]})]}),e.jsxs(o,{children:[e.jsx(h,{asChild:!0,children:e.jsx(a,{size:"sm",variant:"ghost",className:"text-orange-400 hover:bg-orange-400/10 hover:text-orange-300",children:e.jsx(V,{className:"w-4 h-4"})})}),e.jsxs(m,{className:"sardinian-card",children:[e.jsxs(x,{children:[e.jsx(j,{children:"Reset Password"}),e.jsxs(u,{children:["Sei sicuro di voler inviare un'email di reset password a ",s.email,"?"]})]}),e.jsxs(g,{children:[e.jsx(f,{children:"Annulla"}),e.jsx(p,{onClick:()=>c("reset_password",null,s.email),children:"Invia Reset"})]})]})]}),e.jsxs(o,{children:[e.jsx(h,{asChild:!0,children:e.jsx(a,{size:"sm",variant:"ghost",className:"text-red-400 hover:bg-red-400/10 hover:text-red-300",children:e.jsx(G,{className:"w-4 h-4"})})}),e.jsxs(m,{className:"sardinian-card",children:[e.jsxs(x,{children:[e.jsx(j,{children:"Elimina Utente"}),e.jsxs(u,{children:["Sei sicuro di voler eliminare l'utente ",s.email,"? Questa azione è irreversibile e rimuoverà tutti i dati associati."]})]}),e.jsxs(g,{children:[e.jsx(f,{children:"Annulla"}),e.jsx(p,{onClick:()=>c("delete",s.id),className:"bg-destructive hover:bg-destructive/90",children:"Elimina"})]})]})]})]})})]},s.id))})]}),l.length===0&&!k&&e.jsx("div",{className:"text-center py-8 text-gray-400",children:n?"Nessun utente trovato per la ricerca.":"Nessun utente registrato."})]})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-gray-400 text-sm",children:["Pagina ",t+1," - Mostrando ",l.length," utenti"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",onClick:()=>v(Math.max(0,t-1)),disabled:t===0,className:"border-white/20 text-white hover:bg-white/10",children:"Precedente"}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>v(t+1),disabled:l.length<b,className:"border-white/20 text-white hover:bg-white/10",children:"Successiva"})]})]})]})}export{X as default};
