import{p as F,r as d,b as A,a0 as m,j as e,B as f,a8 as E,a9 as U,$ as T,C as y,k as N,g as B,h as P,q as M,ad as I,D as H,I as _,J as L,K as G,N as O,O as R,Q as $,T as q,V as J,W as K}from"./index-459497b8.js";import{T as Q}from"./trash-2-848cc76c.js";const z=F("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),D=F("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),W=F("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),V=()=>{const[v,u]=d.useState(!1),{toast:g}=A();return{uploadFile:async(t,i,a,j={})=>{try{if(u(!0),!t)throw new Error("No file selected");const l=i==="avatars"?5*1024*1024:10*1024*1024;if(t.size>l)throw new Error(`File size must be less than ${l/(1024*1024)}MB`);if(!["image/jpeg","image/png","image/gif","image/webp"].includes(t.type))throw new Error("File type not supported. Please use JPEG, PNG, GIF, or WebP.");const{data:o,error:h}=await m.storage.from(i).upload(a,t,{cacheControl:"3600",upsert:j.upsert||!0,...j});if(h)throw h;const{data:{publicUrl:w}}=m.storage.from(i).getPublicUrl(o.path);return{success:!0,data:{path:o.path,publicUrl:w,fullPath:o.fullPath}}}catch(l){return console.error("Upload error:",l),g({title:"Errore Upload",description:l.message,variant:"destructive"}),{success:!1,error:l.message}}finally{u(!1)}},deleteFile:async(t,i)=>{try{const{error:a}=await m.storage.from(t).remove([i]);if(a)throw a;return{success:!0}}catch(a){return console.error("Delete error:",a),g({title:"Errore Eliminazione",description:a.message,variant:"destructive"}),{success:!1,error:a.message}}},getPublicUrl:(t,i)=>{const{data:{publicUrl:a}}=m.storage.from(t).getPublicUrl(i);return a},uploading:v}};function X(){var S;const[v,u]=d.useState({avatars:[],"recipe-images":[]}),[g,b]=d.useState(!0),[p,k]=d.useState(""),[t,i]=d.useState("avatars"),{toast:a}=A(),{deleteFile:j}=V();d.useEffect(()=>{l()},[t]);const l=async()=>{try{b(!0);const{data:s,error:r}=await m.storage.from(t).list("",{limit:100,offset:0,sortBy:{column:"created_at",order:"desc"}});if(r)throw r;u(n=>({...n,[t]:s||[]}))}catch(s){a({title:"Errore nel caricamento dei file",description:s.message,variant:"destructive"})}finally{b(!1)}},C=async s=>{(await j(t,s)).success&&(a({title:"File eliminato",description:"Il file è stato eliminato con successo."}),l())},o=s=>{const{data:{publicUrl:r}}=m.storage.from(t).getPublicUrl(s);return r},h=s=>{if(s===0)return"0 Bytes";const r=1024,n=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(s)/Math.log(r));return parseFloat((s/Math.pow(r,c)).toFixed(2))+" "+n[c]},w=s=>new Date(s).toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),x=((S=v[t])==null?void 0:S.filter(s=>s.name.toLowerCase().includes(p.toLowerCase())))||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center",children:[e.jsx(z,{className:"w-6 h-6 mr-2"}),"Gestione Storage"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("select",{value:t,onChange:s=>i(s.target.value),className:"bg-slate-800/50 border border-slate-600 text-white rounded-md px-3 py-2",children:[e.jsx("option",{value:"avatars",children:"Avatar"}),e.jsx("option",{value:"recipe-images",children:"Immagini Ricette"})]}),e.jsxs(f,{onClick:l,variant:"outline",size:"sm",className:"border-white/20 text-white hover:bg-white/10",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Aggiorna"]})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(T,{placeholder:"Cerca file...",value:p,onChange:s=>k(s.target.value),className:"pl-10 bg-slate-800/50 border-slate-600 text-white placeholder:text-gray-400"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(y,{className:"sardinian-card",children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"File Totali"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:x.length})]}),e.jsx(D,{className:"w-8 h-8 text-blue-400"})]})})}),e.jsx(y,{className:"sardinian-card",children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Bucket Attivo"}),e.jsx("p",{className:"text-2xl font-bold text-white capitalize",children:t})]}),e.jsx(z,{className:"w-8 h-8 text-green-400"})]})})}),e.jsx(y,{className:"sardinian-card",children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm",children:"Spazio Utilizzato"}),e.jsx("p",{className:"text-2xl font-bold text-white",children:h(x.reduce((s,r)=>{var n;return s+(((n=r.metadata)==null?void 0:n.size)||0)},0))})]}),e.jsx(W,{className:"w-8 h-8 text-purple-400"})]})})})]}),e.jsxs(y,{className:"sardinian-card",children:[e.jsx(B,{children:e.jsxs(P,{className:"text-white",children:["File in ",t," (",x.length,")"]})}),e.jsx(N,{children:g?e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):x.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:p?"Nessun file trovato per la ricerca.":"Nessun file presente in questo bucket."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-slate-600",children:[e.jsx("th",{className:"p-4 font-medium",children:"Anteprima"}),e.jsx("th",{className:"p-4 font-medium",children:"Nome File"}),e.jsx("th",{className:"p-4 font-medium",children:"Dimensione"}),e.jsx("th",{className:"p-4 font-medium",children:"Creato"}),e.jsx("th",{className:"p-4 font-medium text-right",children:"Azioni"})]})}),e.jsx("tbody",{children:x.map(s=>{var r,n;return e.jsxs("tr",{className:"border-b border-slate-700 hover:bg-slate-800/50",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"w-12 h-12 rounded-lg overflow-hidden bg-slate-700 flex items-center justify-center",children:[e.jsx("img",{src:o(s.name),alt:s.name,className:"w-full h-full object-cover",onError:c=>{c.target.style.display="none",c.target.nextSibling.style.display="flex"}}),e.jsx(D,{className:"w-6 h-6 text-gray-400",style:{display:"none"}})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium truncate max-w-xs",children:s.name}),e.jsx(M,{className:"bg-blue-500/20 text-blue-400 border-0 mt-1",children:((r=s.metadata)==null?void 0:r.mimetype)||"image"})]})}),e.jsx("td",{className:"p-4 text-gray-300",children:h(((n=s.metadata)==null?void 0:n.size)||0)}),e.jsx("td",{className:"p-4 text-gray-300",children:w(s.created_at)}),e.jsx("td",{className:"p-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>window.open(o(s.name),"_blank"),className:"text-blue-400 hover:bg-blue-400/10 hover:text-blue-300",children:e.jsx(I,{className:"w-4 h-4"})}),e.jsx(f,{size:"sm",variant:"ghost",onClick:()=>{const c=document.createElement("a");c.href=o(s.name),c.download=s.name,c.click()},className:"text-green-400 hover:bg-green-400/10 hover:text-green-300",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsxs(_,{children:[e.jsx(L,{asChild:!0,children:e.jsx(f,{size:"sm",variant:"ghost",className:"text-red-400 hover:bg-red-400/10 hover:text-red-300",children:e.jsx(Q,{className:"w-4 h-4"})})}),e.jsxs(G,{className:"sardinian-card",children:[e.jsxs(O,{children:[e.jsx(R,{children:"Elimina File"}),e.jsxs($,{children:['Sei sicuro di voler eliminare il file "',s.name,'"? Questa azione è irreversibile.']})]}),e.jsxs(q,{children:[e.jsx(J,{children:"Annulla"}),e.jsx(K,{onClick:()=>C(s.name),className:"bg-destructive hover:bg-destructive/90",children:"Elimina"})]})]})]})]})})]},s.name)})})]})})})]})]})}const ee=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"}));export{z as H,X as S,ee as a};
